#summary Installation guide

<h1>Installation Guide</h1>

<wiki:toc max_depth="1" />

= Prerequisites =

  * This guide assumes Debian 6.0.0 (Squeeze). It may also work on Ubuntu with some modifications, but we do not test this. Instructions for other Linux distributions likely deviate significantly.
  * It is further assumed that the user "www-data" already exists on the system and that it shall be used to run !WebAnno. Finally, it is expected that you have set up a MySQL database that !WebAnno can use. 
  * All commands assume that you are logged in as the *root* user.

= Tomcat =

   * Install package to install user-instances of Tomcat. 
{{{
$ aptitude install tomcat6-user
}}}
   * Create new instance
{{{
$ cd /opt
$ tomcat6-instance-create -p 18080 -c 18005 webanno
$ chown -R www-data /opt/webanno
}}}
   * Configure the startup script. Edit `/etc/init.d/webanno` and add the following contents:SampleData
{{{
#!/bin/sh
export JAVA_OPTS="-Djava.awt.headless=true -Xmx750m -XX:+UseConcMarkSweepGC -Dwebanno.home=/srv/webanno"

case "$1" in
start)
su -c "sh /opt/webanno/bin/startup.sh" www-data
;;

stop)
su -c "sh /opt/webanno/bin/shutdown.sh" www-data
;;

restart)
su -c "sh /opt/webanno/bin/shutdown.sh" www-data
su -c "sh /opt/webanno/bin/startup.sh" www-data
;;
esac

exit 0
}}}
   * Make the script executable and register it to run during system start:
{{{
$ chmod +x /etc/init.d/webanno
$ update-rc.d webanno defaults
}}}

= Tomcat behind Apache Web-Server =

These are *optional* instructions if you want to run !WebAnno behind an Apache web-server instead of accessing it directly. This assumes that you already have the following packages installed:

   * Apache Web Server
   * mod_proxy
   * mod_proxy_ajp

   * Edit `/opt/webanno/conf/server.xml`
      * Enable AJP Connector on localhost (comment in and add address)
{{{
<Connector port="38009" protocol="AJP/1.3" redirectPort="8443" address="127.0.0.1"/>
}}}
      * Disable HTTP Connector (just comment it out)
{{{
<!--Connector port="38080" protocol="HTTP/1.1".
           connectionTimeout="20000".
           URIEncoding="UTF-8"
           redirectPort="8443" /-->
}}}
   * Edit `/etc/apache2/conf.d/webanno.local`
{{{
ProxyPreserveHost On

<Proxy ajp://localhost/webanno >
  Order Deny,Allow
  Deny from none
  Allow from all
</Proxy>

<Location /webanno >
  ProxyPass ajp://localhost:18009/webanno-experimental timeout=1200
  ProxyPassReverse http://localhost/webanno
</Location>
}}}
   * Restart Apache web server
{{{
$ sudo /etc/init.d/apache2 restart
}}}

= MySQL =

   * Install MySQL
{{{
$ sudo apt-get install mysql-server
}}}
   * login to MySQL
{{{
$ mysql -u root -p
}}}
   * Create databases
{{{
mysql> CREATE DATABASE webanno; 
}}}
   * create a database user called `webanno` with the password `t0t4llYSecreT`which is later used by the application to access the database (instructions for `settings.properties`file below).
{{{
mysql> CREATE USER 'webanno'@'localhost' IDENTIFIED BY 't0t4llYSecreT';
mysql> GRANT ALL PRIVILEGES ON * . * TO 'webanno'@'localhost';
}}}

= !WebAnno =
   * Place the !WebAnno WAR into the Tomcat `webapps` folder:
{{{
$ cp webanno.war /opt/webanno/webapps/webanno.war
}}}
   * Create !WebAnno home folder
{{{
$ mkdir /srv/webanno
}}}
   * *Optional* If you want to test !WebAnno with some sample data, skip the _Users and permissions_ section and follow the instraction at [Sampledata], then come back here.
   * Edit `/srv/webanno/settings.properties` to define the database connection:
{{{
database.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
database.driver=com.mysql.jdbc.Driver
database.url=jdbc:mysql://localhost:3306/DATABASE
database.username=webanno
database.password=t0t4llYSecreT
}}}
   * Edit `/srv/webanno/formats.properties` and add the following content:
{{{
text.label=Plain text
text.reader=de.tudarmstadt.ukp.dkpro.core.io.text.TextReader
text.writer=de.tudarmstadt.ukp.dkpro.core.io.text.TextWriter

tcf.label=Weblicht TCF Format
tcf.reader=de.tudarmstadt.ukp.clarin.webanno.tcf.TcfReader
tcf.writer=de.tudarmstadt.ukp.clarin.webanno.tcf.TcfWriter

xmi.label=XMI format
xmi.reader=de.tudarmstadt.ukp.dkpro.core.io.xmi.XmiReader
xmi.writer=de.tudarmstadt.ukp.dkpro.core.io.xmi.XmiWriter

conll.label=Conll Format
conll.reader=de.tudarmstadt.ukp.clarin.webanno.conll.ConllReader
conll.writer=de.tudarmstadt.ukp.clarin.webanno.conll.ConllWriter
}}}
   * Fix permissions in !WebAnno home folder
{{{
$ chown -R www-data /srv/webanno
}}}

= Users and permissions =

   * login to mysql and use the correct database
{{{
$ mysql -u root -p
mysql> USE webanno;
}}}
   * create table user 
{{{
mysql> CREATE  TABLE users(username VARCHAR(45), enabled TINYINT(1),  password VARCHAR(45));
}}}
   * add WebAnno users to user table
{{{
mysql> INSERT INTO users (username, enabled, password) VALUES ('username', 1, 'password');
}}}
 where username is the username to add and password is the password for username
   * Create an authority table
{{{
mysql> CREATE  TABLE authorities(role VARCHAR(10), user VARCHAR(45));
}}}
   * Add users authority in the authorities table
{{{
mysql> INSERT INTO authorities (role, user) VALUES ('ROLE_ADMIN', 'user1'); 
mysql> INSERT INTO authorities (role, user) VALUES ('ROLE_USER', 'user2');
}}} 
where user1 and user2 are already added user names in users table
   
= Use !WebAnno =

   * Start !WebAnno
{{{
$ service webanno-testing start
}}}
   * Open it with your browser at `http://localhost:18080/webanno`. If you chose to run !WebAnno behind the Apache web-server use `http://localhost/webanno`.