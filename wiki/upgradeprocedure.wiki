#summary One-sentence summary of this page.

= Upgrade Procedure =

== Upgrading from version 0.2.0 to 0.3.0 ==
The database schema for annotation document and source document is modified to include the *state* of the document.
To upgrade your existing application from 0.2.0 to 0.3.0
  # Start your application server with the new webanno.war file
  # run the following commands in mysql:
{{{
USE webanno;
UPDATE `source_document`  SET `state`='NEW';
UPDATE `annotation_document` SET `state`='INPROGRESS';
UPDATE `source_document` SET `format`='tcf' WHERE `format`='Weblicht TCF Format';
UPDATE `source_document` SET `format`='text' WHERE `format`='Plain text';
UPDATE `source_document` SET `format`='xmi' WHERE `format`='XMI format';
UPDATE `source_document` SET `format`='conll' WHERE `format`='Conll Format';
}}}
  # Restart your application

== Copying data and metadata from version 0.2.0 to 0.3.0 ==
If you have annotation data and metadata in 0.2.0 and want to migrate to 0.3.0, do the following steps

   * Copy database to new 0.3.0 instance
   # create the database for 0.3.0
{{{
mysql> create database webanno
}}}
   # start webanno
   # create mysqldump from 0.2.0
{{{
mysqldump -u root -p webanno > webanno.sql
}}}
   # restore the mysqldump data to 0.3.0 webanno database
{{{
mysql -u root -p  webanno < webanno.sql
}}}
   # make updates appropraitely as stated above (UPDATE `webanno`.....)
   # restart webanno


  * copy database to existing 0.3.0 database
  # create mysqldump only for data
{{{
mysqldump -u root -p -t -c webanno > webanno.sql
}}}
  # restore only the data to the existing database 
{{{
mysql -u root -p -f webanno < webanno.sql
}}}

  # make updates appropraitely as stated above (UPDATE `webanno`.....)
  # restart webanno
== Upgrading from version 0.3.0 to 0.4.0 ==
Make a achaneg to the authorities schema as follows
  # change the role column as
{{{
alter table `authorities`  change `role` `authority` VARCHAR(255) NOT NULL ;
}}}
  # change user column as follows:
{{{
alter table `authorities`  change `user` `username` VARCHAR(255) NOT NULL ;
}}}
  # If the username admin is not present, create it as follows:
{{{
INSERT INTO `users` (`username`, `enabled`, `password`) VALUES ('admin', '1', 'b7f76f3d1cfa8746e9d44a9ccca81bf22e0e123f06519fc964f97172d5d61b731e9bf8a11da4a3d0');
}}}
  # If the user name admin is already there, update the old password with a hash as follows:
{{{
UPDATE `users` SET `password`='b7f76f3d1cfa8746e9d44a9ccca81bf22e0e123f06519fc964f97172d5d61b731e9bf8a11da4a3d0' WHERE `username`='admin';
}}}
  # Log in to webanno using admin/admin
  # Go to *manage users* and update passwords for the remaining users. Make sure that ROLE_USER is selected for every user. Multiple roles can be selected by selecting using *ctrl + click *